<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Elsa Granger]]></title><description><![CDATA[Elsa Granger Personal Page]]></description><link>https://blog.elsagranger.com</link><generator>GatsbyJS</generator><lastBuildDate>Mon, 05 Apr 2021 09:14:51 GMT</lastBuildDate><item><title><![CDATA[imx7d 一些配置]]></title><description><![CDATA[GPIO PINOUT 的参考为 I/O Pinouts GPIO2_IO00 对应的是 sysfs 中的 ，或者 chardev 的  的  bme280 将 i2c 的接口接在 i2c-0 上，使用  得到 说明在 i2c-0 上的 0x77 位置。同样也可以扫 i2c-…]]></description><link>https://blog.elsagranger.com/imx7d/</link><guid isPermaLink="false">https://blog.elsagranger.com/imx7d/</guid><pubDate>Sun, 04 Apr 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;GPIO&lt;/h2&gt;
&lt;p&gt;PINOUT 的参考为 &lt;a href=&quot;https://developer.android.com/things/hardware/imx7d&quot;&gt;I/O Pinouts&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;GPIO2_IO00 对应的是 sysfs 中的 &lt;code class=&quot;language-text&quot;&gt;(2-1)*32 + 0&lt;/code&gt;，或者 chardev 的 &lt;code class=&quot;language-text&quot;&gt;/dev/gpiochip1&lt;/code&gt; 的 &lt;code class=&quot;language-text&quot;&gt;line=0&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /sys/class/gpio/export
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; out &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /sys/class/gpio/gpio32/direction
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /sys/class/gpio/gpio32/value&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; periphery &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; GPIO
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; time

r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; GPIO&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/dev/gpiochip1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;out&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
g &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; GPIO&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/dev/gpiochip1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;out&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; GPIO&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/dev/gpiochip1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;out&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;write&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        g&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;write&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;write&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sleep&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;close&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
g&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;close&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;close&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;bme280&lt;/h2&gt;
&lt;p&gt;将 i2c 的接口接在 i2c-0 上，使用 &lt;code class=&quot;language-text&quot;&gt;i2cdetect&lt;/code&gt; 得到&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;txt&quot;&gt;&lt;pre class=&quot;language-txt&quot;&gt;&lt;code class=&quot;language-txt&quot;&gt;elsa@imx7d:~$ i2cdetect -y 0
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- UU -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: -- -- -- -- -- -- -- 77&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;说明在 i2c-0 上的 0x77 位置。同样也可以扫 i2c-1 和 i2c-3，但是就没有。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;txt&quot;&gt;&lt;pre class=&quot;language-txt&quot;&gt;&lt;code class=&quot;language-txt&quot;&gt;elsa@imx7d:~$ i2cdetect -y 1
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: -- -- -- -- -- -- -- --&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;txt&quot;&gt;&lt;pre class=&quot;language-txt&quot;&gt;&lt;code class=&quot;language-txt&quot;&gt;elsa@imx7d:~$ i2cdetect -y 3
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- UU -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: -- -- -- -- -- -- -- --&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果强制全部扫描，那么就是如下的结果&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;txt&quot;&gt;&lt;pre class=&quot;language-txt&quot;&gt;&lt;code class=&quot;language-txt&quot;&gt;elsa@imx7d:~$ i2cdetect -y -a 0
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00: 00 -- -- -- -- -- -- -- -- -- UU -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: -- -- -- -- -- -- -- 77 -- -- -- -- -- -- -- --
elsa@imx7d:~$ i2cdetect -y -a 1
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00: 00 -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
elsa@imx7d:~$ i2cdetect -y -a 3
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00: 00 -- -- -- -- -- -- -- UU -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;没有测试 0x00 能不能用&lt;/p&gt;
&lt;p&gt;得到 i2c 的配置，就可以用 &lt;a href=&quot;https://github.com/rm-hull/bme280&quot;&gt;RPi.bme280&lt;/a&gt; 得到数据，其中结果打印成了 influx line protocol便于被 telegraf 读取。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; smbus2
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; bme280

port &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
address &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0x77&lt;/span&gt;
bus &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; smbus2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;SMBus&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;port&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

calibration_params &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bme280&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;load_calibration_params&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bus&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; address&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bme280&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sample&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bus&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; address&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; calibration_params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;environment,location=lug206 temperature={},pressure={},humidity={} {}&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;temperature&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pressure&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;humidity&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timestamp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timestamp&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;网络&lt;/h2&gt;
&lt;p&gt;用 wpa&lt;em&gt;supplicant 只能 hdcp 到 ipv6 的地址，尝试了 [Arch Wiki 的 wpa&lt;/em&gt;supplicant 页面](&lt;a href=&quot;https://wiki.archlinux.org/index.php/wpa_supplicant#At_boot_(systemd)&quot;&gt;https://wiki.archlinux.org/index.php/wpa_supplicant#At_boot_(systemd)&lt;/a&gt;)中提到的几种方法，
都会有 &lt;code class=&quot;language-text&quot;&gt;/run/wpa_supplicant/wlan0&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;/var/run/wpa_supplicant/wlan0&lt;/code&gt; 被占用的情况。不过把整个系统重启安装之后，第一次启动并没有出现这两个文件。
可能是因为之前的 NetworkManager 遗留的问题，不要安装 NetworkManager 只用 systemd-networkd 应该会正常。不过没有尝试了。&lt;/p&gt;
&lt;p&gt;最后直接用 NetworkManager 来连接，会有设置了静态 IP 之后仍然会有 DHCP 得到的一个 IP 地址的问题。&lt;/p&gt;
&lt;p&gt;同时使用 NetworkManager 也可以直接管理 WireGuard。&lt;/p&gt;
&lt;h2&gt;WireGuard&lt;/h2&gt;
&lt;p&gt;WireGuard 被编译进了内核，就不需要添加内核模块&lt;/p&gt;
&lt;p&gt;参考&lt;a href=&quot;https://blogs.gnome.org/thaller/2019/03/15/wireguard-in-networkmanager/&quot;&gt;这个文章&lt;/a&gt;可以得到如何使用 NetworkManager 来导入 WireGuard 的配置。&lt;/p&gt;
&lt;p&gt;但是直接 &lt;code class=&quot;language-text&quot;&gt;up&lt;/code&gt; 会出错&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;txt&quot;&gt;&lt;pre class=&quot;language-txt&quot;&gt;&lt;code class=&quot;language-txt&quot;&gt;elsa@imx7d:~$ sudo nmcli connection up wg.elsa.imx7d
Error: Connection activation failed: Activation failed because the device is unmanaged

elsa@imx7d:~$ sudo nmcli connection up wg.elsa.imx7d
Error: Connection activation failed: Connection &amp;#39;wg.elsa.imx7d&amp;#39; is not available on device wg.elsa.imx7d because device is strictly unmanaged&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;用了&lt;a href=&quot;https://askubuntu.com/a/1075112&quot;&gt;这个回答&lt;/a&gt;，强制加载类型为 none 的设备&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;touch&lt;/span&gt; /etc/NetworkManager/conf.d/10-globally-managed-devices.conf&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;重启之后就正常了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[OpenVPN to Shadowsocks]]></title><description><![CDATA[OpenVPN 转 SOCKS 安装 使用 docker-openvpn-client-socks 可以直接  启动，或者修改  其中，去掉了要求 tty 的参数，便于添加为 systemd 服务 使用 docker build 镜像 之后就可以使用 curl…]]></description><link>https://blog.elsagranger.com/openvpn-socks-shadowsocks/</link><guid isPermaLink="false">https://blog.elsagranger.com/openvpn-socks-shadowsocks/</guid><pubDate>Sat, 27 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;OpenVPN 转 SOCKS&lt;/h2&gt;
&lt;h3&gt;安装&lt;/h3&gt;
&lt;p&gt;使用 &lt;a href=&quot;https://github.com/kizzx2/docker-openvpn-client-socks&quot;&gt;docker-openvpn-client-socks&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;可以直接 &lt;code class=&quot;language-text&quot;&gt;./start PATH-TO-OVPN-CONF&lt;/code&gt; 启动，或者修改 &lt;code class=&quot;language-text&quot;&gt;start&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/sh&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; docker run &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --rm &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --device&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/dev/net/tun &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;openvpn-client &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --cap-add&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;NET_ADMIN &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --publish &lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:1080:1080 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --volume &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;realpath &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$1&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;:/etc/openvpn/:ro&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --sysctl net.ipv6.conf.all.disable_ipv6&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    openvpn-client-socks&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中，去掉了要求 tty 的参数，便于添加为 systemd 服务&lt;/p&gt;
&lt;p&gt;使用 docker build 镜像&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;docker build &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; -t openvpn-client-socks&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;之后就可以使用 curl 进行测试&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;http_proxy&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;socks://localhost:9050&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;https_proxy&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$http_proxy&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; https://github.com -vvvv --head&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;备注&lt;/h3&gt;
&lt;p&gt;最好在一个新的文件夹下面放置 OpenVPN 的文件，并且后缀名是 conf 而不是 ovpn&lt;/p&gt;
&lt;p&gt;在 OpenVPN 的配置文件中的 &lt;code class=&quot;language-text&quot;&gt;dev&lt;/code&gt; 选项中，要将 tun 设备名设置为 &lt;code class=&quot;language-text&quot;&gt;tun0&lt;/code&gt;，与 &lt;code class=&quot;language-text&quot;&gt;sockd.conf&lt;/code&gt; 中的 &lt;code class=&quot;language-text&quot;&gt;external&lt;/code&gt; 相匹配&lt;/p&gt;
&lt;h2&gt;SOCKS to Shadowsocks&lt;/h2&gt;
&lt;p&gt;由于使用的是 v2ray，可以转成任意的协议&lt;/p&gt;
&lt;p&gt;配置参考&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;{
  &amp;quot;inbounds&amp;quot;: [
    {
      &amp;quot;port&amp;quot;: 16823,
      &amp;quot;protocol&amp;quot;: &amp;quot;shadowsocks&amp;quot;,
      &amp;quot;settings&amp;quot;: {
        &amp;quot;method&amp;quot;: &amp;quot;aes-128-gcm&amp;quot;,
        &amp;quot;password&amp;quot;: &amp;quot;password&amp;quot;,
        &amp;quot;level&amp;quot;: 0,
        &amp;quot;ota&amp;quot;: false,
        &amp;quot;network&amp;quot;: &amp;quot;tcp&amp;quot;
      }
    }
  ],
  &amp;quot;outbounds&amp;quot;: [
    {
      &amp;quot;protocol&amp;quot;: &amp;quot;socks&amp;quot;,
      &amp;quot;settings&amp;quot;: {
        &amp;quot;servers&amp;quot;: [
          {
            &amp;quot;address&amp;quot;: &amp;quot;127.0.0.1&amp;quot;,
            &amp;quot;port&amp;quot;: 9050
          }
        ]
      }
    }
  ]
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;后记&lt;/h2&gt;
&lt;p&gt;性能要求有点高&lt;/p&gt;
&lt;h3&gt;Pi 3b&lt;/h3&gt;
&lt;p&gt;使用树莓派 3B 跑这一套流程，v2ray 会有极高的延迟，但是直连 SOCKS 就没有问题。速度比较慢，很容易跑满树莓派的 CPU&lt;/p&gt;
&lt;p&gt;vless -&gt; socks -&gt; openvpn&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1140px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 32.98245614035088%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3AWD/8QAFxABAAMAAAAAAAAAAAAAAAAAEQABIf/aAAgBAQABBQIsNn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAYEAEAAwEAAAAAAAAAAAAAAAABABAhEf/aAAgBAQABPyFTSQWjlf/aAAwDAQACAAMAAAAQg8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAACAgMAAAAAAAAAAAAAAAAAEQExIUFR/9oACAEBAAE/EFJht8IlJWyGs2f/2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;vless -&amp;gt; socks -&amp;gt; openvpn, pi&quot;
        title=&quot;vless -&amp;gt; socks -&amp;gt; openvpn, pi&quot;
        src=&quot;/static/85dca371e0fbd916094dd4992d54f887/65ac4/vless-socks-openvpn-pi.jpg&quot;
        srcset=&quot;/static/85dca371e0fbd916094dd4992d54f887/65031/vless-socks-openvpn-pi.jpg 285w,
/static/85dca371e0fbd916094dd4992d54f887/fd252/vless-socks-openvpn-pi.jpg 570w,
/static/85dca371e0fbd916094dd4992d54f887/65ac4/vless-socks-openvpn-pi.jpg 1140w,
/static/85dca371e0fbd916094dd4992d54f887/38ece/vless-socks-openvpn-pi.jpg 1280w&quot;
        sizes=&quot;(max-width: 1140px) 100vw, 1140px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;socks -&gt; openvpn&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1140px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 44.21052631578947%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAUD/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAG4nYs7DAv/xAAaEAABBQEAAAAAAAAAAAAAAAADAAEQMjNB/9oACAEBAAEFAuwbRkCn/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECIf/aAAgBAwEBPwF2LT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAVEAEBAAAAAAAAAAAAAAAAAAAQAf/aAAgBAQAGPwJr/8QAGxABAAEFAQAAAAAAAAAAAAAAALEBESExUWH/2gAIAQEAAT8h7Zv4ojNkr//aAAwDAQACAAMAAAAQ6w//xAAWEQEBAQAAAAAAAAAAAAAAAAABEQD/2gAIAQMBAT8QipMou//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/EIf/xAAdEAACAgEFAAAAAAAAAAAAAAAAARExsSFhceHw/9oACAEBAAE/EGsV0J0NNKc9Ektcnq2Kizmf/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;socks -&amp;gt; openvpn, pi&quot;
        title=&quot;socks -&amp;gt; openvpn, pi&quot;
        src=&quot;/static/915fa7850622b9c17fb40f02e077c648/65ac4/socks-openvpn-pi.jpg&quot;
        srcset=&quot;/static/915fa7850622b9c17fb40f02e077c648/65031/socks-openvpn-pi.jpg 285w,
/static/915fa7850622b9c17fb40f02e077c648/fd252/socks-openvpn-pi.jpg 570w,
/static/915fa7850622b9c17fb40f02e077c648/65ac4/socks-openvpn-pi.jpg 1140w,
/static/915fa7850622b9c17fb40f02e077c648/38ece/socks-openvpn-pi.jpg 1280w&quot;
        sizes=&quot;(max-width: 1140px) 100vw, 1140px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;x86&lt;/h3&gt;
&lt;p&gt;在一台 i5-4590 机器上跑&lt;/p&gt;
&lt;p&gt;shadowsocks -&gt; socks -&gt; openvpn&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1140px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.63157894736842%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAe4sFZ1Ehf/EABkQAAIDAQAAAAAAAAAAAAAAAAARAQIhEP/aAAgBAQABBQLmkt6VP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/Aar/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAACAwEAAAAAAAAAAAAAAAAAMQEQkUH/2gAIAQEABj8CEdHOjna//8QAHRAAAgEEAwAAAAAAAAAAAAAAAREAITFRYXHB0f/aAAgBAQABPyGrNXqIPwJyg2ZIBbsQirm+Z//aAAwDAQACAAMAAAAQ29//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QZp//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAfEAEAAwAABwEAAAAAAAAAAAABABEhMUFRYYGh0fD/2gAIAQEAAT8QRMoOZKqCArR5PcSyoX0CCpPfBfZiZ/jnFu37kz//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;shadowsocks -&amp;gt; socks -&amp;gt; openvpn, i5-4590&quot;
        title=&quot;shadowsocks -&amp;gt; socks -&amp;gt; openvpn, i5-4590&quot;
        src=&quot;/static/0604741476138a834e7c032e896002c9/65ac4/shadowsocks-socks-openvpn-x86.jpg&quot;
        srcset=&quot;/static/0604741476138a834e7c032e896002c9/65031/shadowsocks-socks-openvpn-x86.jpg 285w,
/static/0604741476138a834e7c032e896002c9/fd252/shadowsocks-socks-openvpn-x86.jpg 570w,
/static/0604741476138a834e7c032e896002c9/65ac4/shadowsocks-socks-openvpn-x86.jpg 1140w,
/static/0604741476138a834e7c032e896002c9/38ece/shadowsocks-socks-openvpn-x86.jpg 1280w&quot;
        sizes=&quot;(max-width: 1140px) 100vw, 1140px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;可能需要优化，但是本身 &lt;code class=&quot;language-text&quot;&gt;openvpn&lt;/code&gt; 服务以及 &lt;code class=&quot;language-text&quot;&gt;sockd&lt;/code&gt; 服务占用的资源就已经比较多了&lt;/p&gt;</content:encoded></item><item><title><![CDATA[WireGuard 配置]]></title><description><![CDATA[Installation 比较新的内核都已经将 WireGuard 打包进了内核，直接安装管理工具即可 查看是否安装完成 在  后追加  使得能够自动载入内核模块 Config 生成公私钥 Peer 1 这个作为接受外来连接的对等端 编辑 ，添加 Peer 2 Route…]]></description><link>https://blog.elsagranger.com/wireguard/</link><guid isPermaLink="false">https://blog.elsagranger.com/wireguard/</guid><pubDate>Fri, 26 Mar 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Installation&lt;/h2&gt;
&lt;p&gt;比较新的内核都已经将 WireGuard 打包进了内核，直接安装管理工具即可&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; wireguard&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看是否安装完成&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sudo modprobe wireguard | lsmod | grep wireguard&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在 &lt;code class=&quot;language-text&quot;&gt;/etc/moduels&lt;/code&gt; 后追加 &lt;code class=&quot;language-text&quot;&gt;wireguard&lt;/code&gt; 使得能够自动载入内核模块&lt;/p&gt;
&lt;h2&gt;Config&lt;/h2&gt;
&lt;h3&gt;生成公私钥&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;wg genkey &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; private &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; wg pubkey &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; public&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Peer 1&lt;/h3&gt;
&lt;p&gt;这个作为接受外来连接的对等端&lt;/p&gt;
&lt;p&gt;编辑 &lt;code class=&quot;language-text&quot;&gt;/etc/wireguard/wg0.conf&lt;/code&gt;，添加&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;[Interface]
Address = 10.1.1.1/24 # 对等端的 IP
ListenPort = 48659 # 监听的端口
PrivateKey = Private Key 1

[Peer] # 发起连接到这个客户端的对端
PublicKey = Public key 2
AllowedIPs = 10.1.1.2/32
PersistentKeepalive = 15&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Peer 2&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;[Interface]
PrivateKey = Private Key 2
Address = 10.1.1.2/24 # 发起连接的客户端的地址

[Peer]
PublicKey = Public Key 1
AllowedIPs = 10.1.1.0/24 # 在本地有哪些 IP 地址需要走 wg 的端口出去
Endpoint = ip1:port
PersistentKeepalive = 15&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Route&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;参考了 &lt;a href=&quot;https://gobomb.github.io/post/wireguard-notes/&quot;&gt;Wireguard 使用笔记&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Forward&lt;/h3&gt;
&lt;p&gt;需要修改 &lt;code class=&quot;language-text&quot;&gt;/etc/sysctl.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;net.ipv4.ip_forward = 1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;使得允许内核转发&lt;/p&gt;
&lt;h3&gt;iptables&lt;/h3&gt;
&lt;p&gt;现在应该已经可以访问 WireGuard 的内网中的其他设备了，但是无法通过另一个设备将包转发出去&lt;/p&gt;
&lt;p&gt;添加 iptables 的 filter 表中 FORWARD 链的规则，允许来自 wg0 和发往 wg0 的包通过&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;iptables -t filter -A FORWARD -i wg0 -j ACCEPT
iptables -t filter -A FORWARD -o wg0 -j ACCEPT&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在这个时候应该可以在外面的设备上收到了请求，但是外面的设备收到的 ip 的源地址是内网地址，
而其上面不会有到内网地址的路由，因此需要通过 NAT 将源地址修改为出口网卡的出口地址&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;iptables -t nat -A POSTROUTING -s &lt;span class=&quot;token number&quot;&gt;10.1&lt;/span&gt;.1.0/24 -o eth0 -j MASQUERADE&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;之后就应该可以正常地访问了&lt;/p&gt;
&lt;h2&gt;Config&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;[Interface]
    Address = 10.3.1.1/24
    ListenPort = 48659
    PrivateKey = Pirvate Key 1
    PostUp = iptables -t filter -A FORWARD -i %i -j ACCEPT; iptables -t filter -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -s 10.3.1.0/24 -o wlan0 -j MASQUERADE
    PostDown = iptables -t filter -D FORWARD -i %i -j ACCEPT; iptables -t filter -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -s 10.3.1.0/24 -o wlan0 -j MASQUERADE
[Peer]
    PublicKey = Public Key 2
    AllowedIPs = 10.3.1.2/32
    PersistentKeepalive = 15&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;[Interface]
PrivateKey = Private Key 2
Address = 10.3.1.2/24

[Peer]
PublicKey = Public Key 1
AllowedIPs = 10.3.1.0/24
Endpoint = ip:port
PersistentKeepalive = 15&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[InfluxDB Telegraf Grafana 配置]]></title><description><![CDATA[Installation InfluxDB and Telegraf 安装的是 1.x 版本，并不是 2 的 beta 版 Grafana Configure InfluxDB 创建用户 使用  进入 influxdb 的交互 创建 database…]]></description><link>https://blog.elsagranger.com/influxdb-telegraf-grafana/</link><guid isPermaLink="false">https://blog.elsagranger.com/influxdb-telegraf-grafana/</guid><pubDate>Sat, 07 Nov 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Installation&lt;/h2&gt;
&lt;h3&gt;InfluxDB and Telegraf&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;安装的是 1.x 版本，并不是 2 的 beta 版&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; -qO- https://repos.influxdata.com/influxdb.key &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; apt-key &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; -
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;deb https://repos.influxdata.com/ubuntu &lt;span class=&quot;token variable&quot;&gt;${lsb_release -cs}&lt;/span&gt; stable&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; /etc/apt/sources.list.d/influxdb.list

&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; update &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; telegraf influxdb&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Grafana&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; -y apt-transport-https
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; -y software-properties-common &lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; -q -O - https://packages.grafana.com/gpg.key &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; apt-key &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; -
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;deb https://packages.grafana.com/enterprise/deb stable main&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; -a /etc/apt/sources.list.d/grafana.list &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Configure&lt;/h2&gt;
&lt;h3&gt;InfluxDB&lt;/h3&gt;
&lt;h4&gt;创建用户&lt;/h4&gt;
&lt;p&gt;使用 &lt;code class=&quot;language-text&quot;&gt;influx&lt;/code&gt; 进入 influxdb 的交互&lt;/p&gt;
&lt;h5&gt;创建 database&lt;/h5&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;database&lt;/span&gt; telegraf&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;创建用户&lt;/h5&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;user&lt;/span&gt; admin &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; password &lt;span class=&quot;token string&quot;&gt;&apos;ROOT PASSWORD&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;all&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;privileges&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;user&lt;/span&gt; telegrafuser &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; password &lt;span class=&quot;token string&quot;&gt;&apos;PASSWORD HERE&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;设置权限&lt;/h5&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;grant&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;all&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;on&lt;/span&gt; telegraf &lt;span class=&quot;token keyword&quot;&gt;to&lt;/span&gt; telegrafuser&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;设置认证&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;/etc/influxdb/influxdb.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;[http]
  # Determines whether HTTP endpoint is enabled.
  enabled = true

  # The bind address used by the HTTP service.
  bind-address = &amp;quot;:8086&amp;quot;

  # Determines whether user authentication is enabled over HTTP/HTTPS.
  auth-enabled = true&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Telegraf&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;# 去掉注释
[[inputs.net]]

# 添加 influxdb 信息
[[outputs.influxdb]]
    urls = [&amp;quot;http://influxdb-url&amp;quot;]
    username = &amp;quot;telegrafuser&amp;quot;
    password = &amp;quot;PASSWORD HERE&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Grafana&lt;/h3&gt;
&lt;p&gt;允许匿名访问&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;[auth.anonymous]
# enable anonymous access
enabled = true&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;InfluxDB&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;show&lt;/span&gt; tag &lt;span class=&quot;token keyword&quot;&gt;values&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;host&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Let's Encrypt 配置]]></title><description><![CDATA[Installation Configure 假设网站为 example.com 在 Nginx/OpenResty 对应的 conf 中添加 添加在 http 下的即可 在  下面创建需要的文件夹 Obain Webroot  为申请者邮箱， 为 webroot…]]></description><link>https://blog.elsagranger.com/letsencrypt/</link><guid isPermaLink="false">https://blog.elsagranger.com/letsencrypt/</guid><pubDate>Sat, 07 Nov 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Installation&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; certbot&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Configure&lt;/h2&gt;
&lt;p&gt;假设网站为 example.com&lt;/p&gt;
&lt;p&gt;在 Nginx/OpenResty 对应的 conf 中添加&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;location /.well-known/acme-challenge/ {
    default_type &amp;quot;text/plain&amp;quot;;
    root /var/www/html/example.com;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;添加在 http 下的即可&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在 &lt;code class=&quot;language-text&quot;&gt;/var/www/html/example.com&lt;/code&gt; 下面创建需要的文件夹&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;pushd&lt;/span&gt; /var/www/html/example.com
&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p .well-known/acme-challenge&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Obain&lt;/h2&gt;
&lt;h3&gt;Webroot&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--email&lt;/code&gt; 为申请者邮箱，&lt;code class=&quot;language-text&quot;&gt;--webroot&lt;/code&gt; 为 webroot 方式，&lt;code class=&quot;language-text&quot;&gt;-w&lt;/code&gt; 为站点目录，&lt;code class=&quot;language-text&quot;&gt;-d&lt;/code&gt; 为要加 https 的域名&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;certbot certonly --email root@example.com &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --webroot -w /var/www/html/example.com &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -d example.com &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -d www.example.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Standalone&lt;/h3&gt;
&lt;p&gt;需要占用 443 端口，需要停止 Nginx 等服务&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;certbot certonly --email admin@example.com &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    --standalone &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -d example.com &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    -d www.example.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Nginx Conf&lt;/h2&gt;
&lt;p&gt;生成的证书会在 &lt;code class=&quot;language-text&quot;&gt;/etc/letsencrypt/live/&lt;/code&gt; 下面&lt;/p&gt;
&lt;p&gt;Nginx Conf 参考&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;server {
    listen 80;
    server_name example.com;
    server_name www.example.com;

    location /.well-known/acme-challenge/ {
        default_type &amp;quot;text/plain&amp;quot;;
        root /usr/local/openresty/nginx/html/example.com;
    }

    location / {
        return 302 https://$server_name$request_uri;
    }
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    server_name example.com;
    server_name www.example.com;

    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;

    location / {
        include proxy_params;
        proxy_pass http://127.0.0.1:3000;
    }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Auto Renew&lt;/h2&gt;
&lt;p&gt;在 cron 中添加&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;0 0 * */2 * certbot renew --quiet --post-hook &amp;quot;openresty -s reload&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;每隔两个月，在 0 点 0 分自动续期&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Time Machine Server on Linux]]></title><description><![CDATA[在 Linux 上配置了 Samba 之后，并不能字节用来作为 Time Machine 的备份分区，在 Finder 的 Network 下，直接尝试 Connect As 并不能够连上服务器，只能通过  连接上去。都是用于没有配置 afp 协议。 Installation…]]></description><link>https://blog.elsagranger.com/time-machine-on-linux/</link><guid isPermaLink="false">https://blog.elsagranger.com/time-machine-on-linux/</guid><pubDate>Sat, 21 Nov 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在 Linux 上配置了 Samba 之后，并不能字节用来作为 Time Machine 的备份分区，在 Finder 的 Network 下，直接尝试 Connect As 并不能够连上服务器，只能通过 &lt;code class=&quot;language-text&quot;&gt;cmd + k&lt;/code&gt; 连接上去。都是用于没有配置 afp 协议。&lt;/p&gt;
&lt;h2&gt;Installation&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; netatalk avahi-daemon&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Configure&lt;/h2&gt;
&lt;h3&gt;netatalk&lt;/h3&gt;
&lt;p&gt;位置 &lt;code class=&quot;language-text&quot;&gt;/etc/netatalk/afp.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;[Global]
 dbus daemon = /usr/bin/dbus-daemon
 disconnect time = 3
 sleep time = 2
 log file = /var/log/netatalk.log
 log level = default:info
 uam list = uams_dhx2.so
 zeroconf = yes
 save password = no


[SharedFolder]
 path = &amp;#39;shared folder path&amp;#39;
 ; http://netatalk.sourceforge.net/wiki/index.php/Spotlight
 ; spotlight = yes
 valid users = USERNAME1 USERNAME2 USERNAME3
 unix priv = yes
 file perm = 0600

[TimeCapsule]
path = &amp;#39;time machine folder&amp;#39;
valid users = USERNAME2
time machine = yes
unix priv = yes
file perm = 0600&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;avahi&lt;/h3&gt;
&lt;p&gt;添加 afp 协议 &lt;/p&gt;
&lt;p&gt;位置 &lt;code class=&quot;language-text&quot;&gt;/etc/avahi/services/timecapsule_afpd.service&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token prolog&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; standalone=&apos;no&apos;?&gt;&lt;/span&gt;
&lt;span class=&quot;token doctype&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;!&lt;/span&gt;&lt;span class=&quot;token doctype-tag&quot;&gt;DOCTYPE&lt;/span&gt; &lt;span class=&quot;token name&quot;&gt;service-group&lt;/span&gt; &lt;span class=&quot;token name&quot;&gt;SYSTEM&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;avahi-service.dtd&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;service-group&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;name&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;replace-wildcards&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;yes&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;%h&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;_afpovertcp._tcp&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;548&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;_device-info._tcp&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;0&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;txt-record&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;model=TimeCapsule&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;txt-record&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
 &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;service-group&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[在 Android Things 上安装 Debian]]></title><description><![CDATA[Android Things 有两个官方支持的版本，一个是 ，另一个是 。后者没有什么可说的，主要是前者应该当如何安装。 主要参考了这个文章 Toolchain 我们需要的有：，， imx_usb_loader ARM Cross Compiler: GCC…]]></description><link>https://blog.elsagranger.com/imx7d-debian/</link><guid isPermaLink="false">https://blog.elsagranger.com/imx7d-debian/</guid><pubDate>Sun, 20 Sep 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Android Things 有两个官方支持的版本，一个是 &lt;code class=&quot;language-text&quot;&gt;NXP i.MX7D&lt;/code&gt;，另一个是 &lt;code class=&quot;language-text&quot;&gt;Raspberry Pi&lt;/code&gt;。后者没有什么可说的，主要是前者应该当如何安装。&lt;/p&gt;
&lt;p&gt;主要参考了&lt;a href=&quot;https://www.digikey.com/eewiki/display/linuxonarm/PICO-PI-IMX7&quot;&gt;这个文章&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Toolchain&lt;/h2&gt;
&lt;p&gt;我们需要的有：&lt;code class=&quot;language-text&quot;&gt;imx_usb_loader&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;ARM Cross Compiler: GCC&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;Bootloader: U-Boot&lt;/code&gt;&lt;/p&gt;
&lt;h3&gt;imx_usb_loader&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/boundarydevices/imx_usb_loader
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; imx_usb_loader/
&lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;ARM Cross Compiler: GCC&lt;/h3&gt;
&lt;p&gt;在&lt;a href=&quot;https://www.linaro.org/downloads/&quot;&gt;这里&lt;/a&gt;找最新的 ARM GCC 交叉编译编译器。&lt;/p&gt;
&lt;p&gt;写这篇文章时最新的为7.5.0&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; -c https://releases.linaro.org/components/toolchain/binaries/latest-7/arm-linux-gnueabihf/gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabihf.tar.xz
&lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; xf gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabihf.tar.xz
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;CC&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt;/gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabihf/bin/arm-linux-gnueabihf-&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;测试一下交叉编译器：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;${CC}&lt;/span&gt;gcc --version&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Bootloader: U-Boot&lt;/h3&gt;
&lt;p&gt;在 &lt;a href=&quot;https://github.com/u-boot/u-boot&quot;&gt;https://github.com/u-boot/u-boot&lt;/a&gt; 上找最新的分支，写文章时为&lt;code class=&quot;language-text&quot;&gt;v2020.10-rc4&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone -b v2020.10-rc4 https://github.com/u-boot/u-boot --depth&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; u-boot/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;编译 u-boot&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;arm &lt;span class=&quot;token assign-left variable&quot;&gt;CROSS_COMPILE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;${CC}&lt;/span&gt; distclean
&lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;arm &lt;span class=&quot;token assign-left variable&quot;&gt;CROSS_COMPILE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;${CC}&lt;/span&gt; pico-pi-imx7d_defconfig
&lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;arm &lt;span class=&quot;token assign-left variable&quot;&gt;CROSS_COMPILE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;${CC}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;从 U-BOOT 启动&lt;/h2&gt;
&lt;h3&gt;设置跳线&lt;/h3&gt;
&lt;p&gt;跳线的具体设置可以参考这里：&lt;a href=&quot;https://www.technexion.com/support/knowledgebase/boot-configuration-settings-for-pico-baseboards/&quot;&gt;https://www.technexion.com/support/knowledgebase/boot-configuration-settings-for-pico-baseboards/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我们需要设置为 USB Boot 启动，即跳线设置为&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 513px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.78947368421053%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADhUlEQVQozw2O2W/aBgCH/dJN01Z1D6uatiHZknIkAQcbbA5jGzCHMTY3BEwDmCvB3EcSCFfSkITmaCulSda16aaoe5i6Pkw7VE3a3qZJe9gfsIftXxnS7+F7+fT9AC2El0ptyedSns8zrvBgcCKVghmhwsdyx8eXUhmYFcqphHg4vtQgpmat3+uMDk8uaDY07B8DPn/I6fHHizW7izVgJO2NRnJFjLTpDVSYF5PihtFC25lALFv38hkH418V1huDvWBqTVirAUEh0+p2r3/4XvXQiZFk9/BAv1tKbK5XKq3UwemkPhyOEvXOysbg5/e/axwc6mH/+fe/83c/RYotQLMaKXSLz756rC9E+Vhi92CfEDOl7cZ4fEJ26ubNtR/fvmldvUCE1JtvLlNHY3e7/v6Xd7nX58aSCHSenInNzaPjZ2KxzUeyIb+QFRrpVC0eyU0uFfcOx4/G5cEeL9b7nWF5dJDp9a6vrqrXXyfOzoDaxs5gq1+rbPP8ejpdivPrK5F8NtMo5JuJbK1U7dUq/XZzd6u5szM43aj0Rzunf/3x96+//dn+7i0AW2yQanlBASFaq8sVZt1Ri5njON7niZEWt88fz2cr6XQ5GS+UClvVSi8UykRD0ccnT5MXTwEmEL079QWkxq0WTq+zGg3OiWm3+UPBpGIJVoF6p91H4DSJ02aSwSdg4RCN2cFGa68vAUckGmA8CGJmmRXaETRhjM0ecLki4VBycRGempqXTMtAJapWG2AIW142YEaHmaBZP194eQGgnNtBUgThxjGGJFiK8tson80R5Lj4EojoDJSN8ijksHJRC8MmFx1kXHwqLjx//iW1vwXoIgGZYhHW6mEjbtRhBj0G6XGdHlOrEbUBxwiH1cppUfOkbKe8Xh8/mZVwtvZOW9ffAlAsEOJZzmO6KZ/BjagVN9ycnfGwpNNqmF2GUcKIo+CsbOHO/Rm3jXhAoDJUZbdpSk8Oy69eAio+sH/0aDBs3ViSZFNCq1q9cfd2Lre62+8hLk5t1A4b+WmFXDI3N2iWVAGnMea7OD9uvHrBjrYBSz5tFlbnKeIT+bwU1EpB+GPJfcLNWn0RHeudgyAlgmpNxMzcg5VYGooGF5KhxNGBai2zJPJAtNmFvL6PlPJb89IPpyW3FLIpUG0Lp0DKjXmCWsr+we07lJ1eXFImMyIS5z+LM5+66Xs0C4oP/weq/i+481jf3AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;jumper usb boot&quot;
        title=&quot;jumper usb boot&quot;
        src=&quot;/static/f2aaedbd2e4eae1ca18491bc5d9a1a0e/bb9ec/pico-imx6-pi-serial-download-mode.png&quot;
        srcset=&quot;/static/f2aaedbd2e4eae1ca18491bc5d9a1a0e/5459c/pico-imx6-pi-serial-download-mode.png 285w,
/static/f2aaedbd2e4eae1ca18491bc5d9a1a0e/bb9ec/pico-imx6-pi-serial-download-mode.png 513w&quot;
        sizes=&quot;(max-width: 513px) 100vw, 513px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;admonition admonition-note alert alert--secondary&quot;&gt;&lt;div class=&quot;admonition-heading&quot;&gt;&lt;h5&gt;&lt;span class=&quot;admonition-icon&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;14&quot; height=&quot;16&quot; viewBox=&quot;0 0 14 16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/span&gt;note&lt;/h5&gt;&lt;/div&gt;&lt;div class=&quot;admonition-content&quot;&gt;&lt;p&gt;板子上有两个跳线连接的地方，要注意应该修改哪个地方&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;lsusb &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; Freescale
&lt;span class=&quot;token comment&quot;&gt;# Output: Bus 00x Device 00y: ID 15a2:0076 Freescale Semiconductor, Inc&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;admonition admonition-caution alert alert--warning&quot;&gt;&lt;div class=&quot;admonition-heading&quot;&gt;&lt;h5&gt;&lt;span class=&quot;admonition-icon&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;16&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/span&gt;Notes&lt;/h5&gt;&lt;/div&gt;&lt;div class=&quot;admonition-content&quot;&gt;&lt;p&gt;如果没有从 usb 启动，不会有 Freescale 的设备，设备的 ID 也是无法对应上的。&lt;/p&gt;&lt;p&gt;如果使用的是 emmc 启动，即 Android，那么显示的是 Google Inc. 的设备，以及设备 ID 将是 18d1:4ee7&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3&gt;使用 USB 加载镜像&lt;/h3&gt;
&lt;p&gt;加载 SPL&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; ~/imx_usb_loader/imx_usb SPL&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;加载 u-boot-dtb.img&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; ~/imx_usb_loader/imx_usb u-boot-dtb.img&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;admonition admonition-note alert alert--secondary&quot;&gt;&lt;div class=&quot;admonition-heading&quot;&gt;&lt;h5&gt;&lt;span class=&quot;admonition-icon&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;14&quot; height=&quot;16&quot; viewBox=&quot;0 0 14 16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/span&gt;启动串口&lt;/h5&gt;&lt;/div&gt;&lt;div class=&quot;admonition-content&quot;&gt;&lt;p&gt;在加载 u-boot-dtb.img 之前，需要打开另一个窗口，打印出串口的内容。&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;admonition admonition-important alert alert--info&quot;&gt;&lt;div class=&quot;admonition-heading&quot;&gt;&lt;h5&gt;&lt;span class=&quot;admonition-icon&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;14&quot; height=&quot;16&quot; viewBox=&quot;0 0 14 16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/span&gt;串口设置&lt;/h5&gt;&lt;/div&gt;&lt;div class=&quot;admonition-content&quot;&gt;&lt;p&gt;可以使用 minicom 进行连接&lt;/p&gt;&lt;p&gt;串口配置：115200, 8N1, 无硬件、软件流控制&lt;/p&gt;&lt;p&gt;&lt;strong&gt;要将硬件流控制关掉，否则将无法输入，也无法跳过 autostart&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;admonition admonition-important alert alert--info&quot;&gt;&lt;div class=&quot;admonition-heading&quot;&gt;&lt;h5&gt;&lt;span class=&quot;admonition-icon&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;14&quot; height=&quot;16&quot; viewBox=&quot;0 0 14 16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/span&gt;避免 autostart&lt;/h5&gt;&lt;/div&gt;&lt;div class=&quot;admonition-content&quot;&gt;&lt;p&gt;并且，在 u-boot-dtb.img 加载之后，会立即启动，需要在串口中快速地按下任意键以避免 autostart。&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Loading Environment from MMC... OK
In:    serial
Out:   serial
Err:   serial
Net:   FEC0
Hit any key to stop autoboot:  0
=&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3&gt;将 u-boot 写入 emmc&lt;/h3&gt;
&lt;p&gt;在前面按下任意键后，会进入 u-boot 命令行，在串口中依次执行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;=&amp;gt; env default -f -a
=&amp;gt; setenv bootm_boot_mode nonsec
=&amp;gt; saveenv&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;admonition admonition-note alert alert--secondary&quot;&gt;&lt;div class=&quot;admonition-heading&quot;&gt;&lt;h5&gt;&lt;span class=&quot;admonition-icon&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;14&quot; height=&quot;16&quot; viewBox=&quot;0 0 14 16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/span&gt;note&lt;/h5&gt;&lt;/div&gt;&lt;div class=&quot;admonition-content&quot;&gt;&lt;p&gt;以 &lt;code class=&quot;language-text&quot;&gt;=&amp;gt;&lt;/code&gt; 开头的为在串口中执行&lt;/p&gt;&lt;p&gt;反之为在 &lt;code class=&quot;language-text&quot;&gt;shell&lt;/code&gt; 中执行&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;将 mmc 0 设置为从数据分区启动，而不是从 boot 分区启动&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;=&amp;gt; mmc partconf 0 0 7 0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;进入 DFU 模式&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;=&amp;gt; dfu 0 mmc 0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;刷入 SPL，需要安装 dfu-util&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; dfu-util -D SPL -a spl&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;刷入 u-boot-dtb.img&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; dfu-util -R -D u-boot-dtb.img -a u-boot&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;从 emmc 启动&lt;/h3&gt;
&lt;p&gt;拔掉电源，将跳线设置为 emmc 启动。&lt;/p&gt;
&lt;p&gt;跳线如图：&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 591px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 68.07017543859648%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAADSklEQVQozw3RWVMadwAA8H3qNG06nc50Rls0mUqEVIHIDXLI5YKAcrOwLiy7/BeWZUEWFlAIglgFT6KikdarbdIr00kz4/S9fepX6EO/S/P7Cj8omS454cBmewAorsy3SXLtYvSaytdyucr5y5+yTJWvduls+fj0lgRlALiTk2uWa200eiRRgMI4jSczsVWwEk+RoIhimUxxPZrM+PwIw1ZTNOf2R4ORJFvtLK5EASgcDW+oaovM873DS6h2NAyieJQEf/z9l5cHRpOVPuglrvt5ls5udPrv7vvHA1+Kqg6Gb979+dHMs9Obq3/+/Y/q7O8MLyFqZztIZdPVyv75nnYtxjA5/rCr6ZB3d4NQryWrZ9/8+i0/OnUV2Fevrx3Pmwejwej+l8Xd9vrxGdS+vm02uvEYiIYJGvB4Ko/GKW57++b2rntzm7t4cXo26I4uXavJIluh6w2mWM1Xm2iRv/35LbT/6rfOZj9NFLFEDkWzJFkAoISTpbMXL9s7J2St09s9am5+o9JbiBRLYDSOs0SSTcXS+e4hFG/UfIGYaykSCGEms9PvxwJB7IlYLpmd0xth2IsaDXa1el4slkWiRDCQ8HgjK37U54tjtTZUPj6hcxUkRkYQgs3X3w8Bqjj5SCSVKFUai9YAi6YVOr1dp7fqtBaV0iKVaT9+8JkpHDj4/R5y13gCcFxpc63Uaj7fazT6eYY3L7gKDIuRjBH2G+btSqVZrV7QaayepfC0SK6SSr1r5MLWBuQsc0GcCiDk+2EScOXyFpbImGH3ksufrXWc8cSyN+p0RxRqi83hx5OMUm6AHU728Ig5v4LCjbomgahdFpNB/vlToUqhkM7JhFaty66S2UxGJKRWzApnZ8YnHjttJpHDpNLNxQCy/v0Pplod+soHT8CWEJXcahQeiMYQJBxDkXH3/MXFXmV7Sx0KZJJBiVw6NjHRqpcfhRZBJXv19sfV4cBR56Epv0vsdeg8To3D+nBKIH6mmNGbhUHPxtl3kXJdHw5OSSRSuVwgECyHYjNYQMEBLV/6kkCWd9uQ0AtbCVLj8X74WPBwcvKD8S8+mRU/sdrsq9mvnS5LODwmmlabbfM2a4pmn/qXP12x6nBUx6YFZOR/yCoz+MztLYEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;jumper emmc boot&quot;
        title=&quot;jumper emmc boot&quot;
        src=&quot;/static/8d60928c9ab2a895918d1005a6c6e754/3d4ad/pico-imx6-pi-emmc.png&quot;
        srcset=&quot;/static/8d60928c9ab2a895918d1005a6c6e754/5459c/pico-imx6-pi-emmc.png 285w,
/static/8d60928c9ab2a895918d1005a6c6e754/2cee3/pico-imx6-pi-emmc.png 570w,
/static/8d60928c9ab2a895918d1005a6c6e754/3d4ad/pico-imx6-pi-emmc.png 591w&quot;
        sizes=&quot;(max-width: 591px) 100vw, 591px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;加电之后，启动板子，进入 u-boot，这里不需要跳过 autoboot&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Loading Environment from MMC... OK
In:    serial
Out:   serial
Err:   serial
Net:   FEC0
Hit any key to stop autoboot:  0
=&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;启动 USB 存储模式&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;=&amp;gt; ums 0 mmc 0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;之后会卡住，操作在电脑上完成&lt;/p&gt;
&lt;div class=&quot;admonition admonition-note alert alert--secondary&quot;&gt;&lt;div class=&quot;admonition-heading&quot;&gt;&lt;h5&gt;&lt;span class=&quot;admonition-icon&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;14&quot; height=&quot;16&quot; viewBox=&quot;0 0 14 16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/span&gt;GPT&lt;/h5&gt;&lt;/div&gt;&lt;div class=&quot;admonition-content&quot;&gt;&lt;p&gt;可能出现 GPT 分区头部 CRC 校验错误，可以忽略&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2&gt;Linux Kernel&lt;/h2&gt;
&lt;p&gt;下载 kernel、modules、device tree&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/RobertCNelson/armv7-lpae-multiplatform
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; armv7-lpae-multiplatform/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;切换到对应分支以选择相应的内核&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; checkout origin/v5.4.x -b tmp&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;编译内核&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;./build_kernel.sh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个脚本会生成内核、模块以及设备树&lt;/p&gt;
&lt;p&gt;在结束后，脚本会显示&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;-----------------------------
Script Complete
eewiki.net: [user@localhost:~$ export kernel_version=5.X.Y-Z]
-----------------------------&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;记录 kernel_version，并执行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;kernel_version&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;.X.Y-Z&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Rootfs&lt;/h2&gt;
&lt;p&gt;在 &lt;a href=&quot;https://rcn-ee.com/rootfs/eewiki/minfs/&quot;&gt;https://rcn-ee.com/rootfs/eewiki/minfs/&lt;/a&gt; 找到 debian 或者 ubuntu 对应的 rootfs&lt;/p&gt;
&lt;p&gt;ubuntu 的默认账号密码为：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;账号&lt;/th&gt;
&lt;th&gt;密码&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ubuntu&lt;/td&gt;
&lt;td&gt;temppwd&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;debian 的默认账号密码为：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;账号&lt;/th&gt;
&lt;th&gt;密码&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;debian&lt;/td&gt;
&lt;td&gt;temppwd&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;以 debian 为例子&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;wget -c https://rcn-ee.com/rootfs/eewiki/minfs/debian-10.5-minimal-armhf-2020-08-24.tar.xz&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;解压&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;tar xf debian-10.5-minimal-armhf-2020-08-24.tar.xz&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;设置本地存储&lt;/h2&gt;
&lt;p&gt;使用 &lt;code class=&quot;language-text&quot;&gt;lsblk&lt;/code&gt; 确定上文中，emmc 的 usb 模式对应的磁盘，为 &lt;code class=&quot;language-text&quot;&gt;/dev/sdb&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;/dev/mmcblk0&lt;/code&gt; 或类似&lt;/p&gt;
&lt;p&gt;设置为环境变量：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;DISK&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/dev/sdb
&lt;span class=&quot;token comment&quot;&gt;# 或&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;DISK&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/dev/mmcblk0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;清空分区表&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dd&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/dev/zero &lt;span class=&quot;token assign-left variable&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;${DISK}&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;bs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1M &lt;span class=&quot;token assign-left variable&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;将 SPL 和 u-boot-dtb.img 写入到 EMMC 中&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dd&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;./u-boot/SPL &lt;span class=&quot;token assign-left variable&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;${DISK}&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;seek&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;bs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1k
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dd&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;./u-boot/u-boot-dtb.img &lt;span class=&quot;token assign-left variable&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;${DISK}&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;seek&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;69&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;bs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1k&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;创建分区表&lt;/h3&gt;
&lt;p&gt;对于 &lt;code class=&quot;language-text&quot;&gt;sfdisk&lt;/code&gt; 版本大于等于 2.26.x&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; sfdisk &lt;span class=&quot;token variable&quot;&gt;${DISK}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;EOF
1M,,L,*
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;对于 &lt;code class=&quot;language-text&quot;&gt;sfdisk&lt;/code&gt; 版本小于等于 2.25.x&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; sfdisk --unit M &lt;span class=&quot;token variable&quot;&gt;${DISK}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;EOF
1,,L,*
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;格式化&lt;/h3&gt;
&lt;p&gt;使用 &lt;code class=&quot;language-text&quot;&gt;sfdisk&lt;/code&gt; 查看 &lt;code class=&quot;language-text&quot;&gt;type&lt;/code&gt; 为 &lt;code class=&quot;language-text&quot;&gt;part&lt;/code&gt; 的分区，如 &lt;code class=&quot;language-text&quot;&gt;/dev/sdb1&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;/dev/mmcblk0p1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;格式化为 ext4&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; mkfs.ext4 -L rootfs /dev/sdb1
&lt;span class=&quot;token comment&quot;&gt;# 或&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; mkfs.ext4 -L rootfs /dev/mmcblk0p1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;挂载&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p /media/rootfs/

&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mount&lt;/span&gt; /dev/sdb1 /media/rootfs/
&lt;span class=&quot;token comment&quot;&gt;# 或&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mount&lt;/span&gt; /dev/mmcblk0p1 /media/rootfs/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;复制 rootfs&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; xfvp ./debian-*-*-armhf-*/armhf-rootfs-*.tar -C /media/rootfs/
&lt;span class=&quot;token function&quot;&gt;sync&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chown&lt;/span&gt; root:root /media/rootfs/
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chmod&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;755&lt;/span&gt; /media/rootfs/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;设置 extlinux.conf&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p /media/rootfs/boot/extlinux/
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; -c &lt;span class=&quot;token string&quot;&gt;&quot;echo &apos;label Linux &lt;span class=&quot;token variable&quot;&gt;${kernel_version}&lt;/span&gt;&apos; &gt; /media/rootfs/boot/extlinux/extlinux.conf&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; -c &lt;span class=&quot;token string&quot;&gt;&quot;echo &apos;    kernel /boot/vmlinuz-&lt;span class=&quot;token variable&quot;&gt;${kernel_version}&lt;/span&gt;&apos; &gt;&gt; /media/rootfs/boot/extlinux/extlinux.conf&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; -c &lt;span class=&quot;token string&quot;&gt;&quot;echo &apos;    append root=/dev/mmcblk2p1 ro rootfstype=ext4 rootwait quiet&apos; &gt;&gt; /media/rootfs/boot/extlinux/extlinux.conf&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; -c &lt;span class=&quot;token string&quot;&gt;&quot;echo &apos;    fdtdir /boot/dtbs/&lt;span class=&quot;token variable&quot;&gt;${kernel_version}&lt;/span&gt;/&apos; &gt;&gt; /media/rootfs/boot/extlinux/extlinux.conf&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;复制 Linux 内核、设备树和模块&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; -v ./armv7-lpae-multiplatform/deploy/&lt;span class=&quot;token variable&quot;&gt;${kernel_version}&lt;/span&gt;*.zImage /media/rootfs/boot/vmlinuz-&lt;span class=&quot;token variable&quot;&gt;${kernel_version}&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p /media/rootfs/boot/dtbs/&lt;span class=&quot;token variable&quot;&gt;${kernel_version}&lt;/span&gt;/
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; xfv ./armv7-lpae-multiplatform/deploy/&lt;span class=&quot;token variable&quot;&gt;${kernel_version}&lt;/span&gt;-dtbs.tar.gz -C /media/rootfs/boot/dtbs/&lt;span class=&quot;token variable&quot;&gt;${kernel_version}&lt;/span&gt;/
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; xfv ./armv7-lpae-multiplatform/deploy/&lt;span class=&quot;token variable&quot;&gt;${kernel_version}&lt;/span&gt;-modules.tar.gz -C /media/rootfs/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;File Systems Table (/etc/fstab)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; -c &lt;span class=&quot;token string&quot;&gt;&quot;echo &apos;/dev/mmcblk2p1  /  auto  errors=remount-ro  0  1&apos; &gt;&gt; /media/rootfs/etc/fstab&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;umount &amp;#x26; exit&lt;/h3&gt;
&lt;p&gt;umount 挂载的盘&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sync&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;umount&lt;/span&gt; /media/rootfs&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;u-boot 退出 usb 挂载 emmc 模式&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Loading Environment from MMC... OK
In:    serial
Out:   serial
Err:   serial
Net:   FEC0
Hit any key to stop autoboot:  0
=&amp;gt; ums 0 mmc 0
UMS: LUN 0, dev0, hwpart 0, section 0x0, count 0x720000
Ctrl+C to exit ...
=&amp;gt; reset&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;启动设备&lt;/h2&gt;
&lt;p&gt;默认的账户与密码在下载 rootfs 中有提到&lt;/p&gt;
&lt;h2&gt;启用另一个 CPU&lt;/h2&gt;
&lt;p&gt;使用 &lt;code class=&quot;language-text&quot;&gt;sudo lshw&lt;/code&gt; 列出硬件信息，可以看出有一个 CPU 内核被禁用，这是由于使用安全模式加载了主线内核的原因&lt;/p&gt;
&lt;p&gt;可以在启动的时候在串口命令中输入&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;=&amp;gt; env default -f -a
=&amp;gt; setenv bootm_boot_mode nonsec
=&amp;gt; saveenv&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;之后再 &lt;code class=&quot;language-text&quot;&gt;reset&lt;/code&gt; 重新启动，重新使用 &lt;code class=&quot;language-text&quot;&gt;lshw&lt;/code&gt;，可以看出 cpu1 也启用了&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;*-core
       description: Motherboard
       physical id: 0
     *-cpu:0
          description: CPU
          product: cpu
          physical id: 0
          bus info: cpu@0
          size: 996MHz
          capabilities: half thumb fastmult vfp edsp thumbee neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm
     *-cpu:1
          description: CPU
          product: cpu
          physical id: 1
          bus info: cpu@1
          size: 996MHz
          capabilities: half thumb fastmult vfp edsp thumbee neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm
     *-cpu:2 DISABLED
          description: CPU
          product: idle-states
          physical id: 2
          bus info: cpu@2
     *-memory
          description: System memory
          physical id: 3
          size: 422MiB&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;admonition admonition-note alert alert--secondary&quot;&gt;&lt;div class=&quot;admonition-heading&quot;&gt;&lt;h5&gt;&lt;span class=&quot;admonition-icon&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;14&quot; height=&quot;16&quot; viewBox=&quot;0 0 14 16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/span&gt;PSCI&lt;/h5&gt;&lt;/div&gt;&lt;div class=&quot;admonition-content&quot;&gt;&lt;p&gt;理论上，可以通过启用 PSCI 来实现使用安全模式下仍然可以使用另一个 CPU&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2&gt;WLAN&lt;/h2&gt;
&lt;p&gt;安装完后，仍然只能使用 LAN 联网，&lt;code class=&quot;language-text&quot;&gt;ip a&lt;/code&gt;下面无法出现 wlan0。&lt;/p&gt;
&lt;p&gt;通过 &lt;code class=&quot;language-text&quot;&gt;dmesg&lt;/code&gt; 可以检查到 brcmfmac 的驱动启动时缺少 &lt;code class=&quot;language-text&quot;&gt;brcmfmac4339-sdio.txt&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;brcmfmac4339-sdio.technexion,imx7d-pico-pi.txt&lt;/code&gt; 两个文件。&lt;/p&gt;
&lt;p&gt;在&lt;a href=&quot;https://raw.githubusercontent.com/buildroot/buildroot/master/board/technexion/imx7dpico/rootfs_overlay/lib/firmware/brcm/brcmfmac4339-sdio.txt&quot;&gt;网络&lt;/a&gt;上可以找到 &lt;code class=&quot;language-text&quot;&gt;brcmfmac4339-sdio.txt&lt;/code&gt; 文件，将其放进 &lt;code class=&quot;language-text&quot;&gt;/lib/firmware/bcrm&lt;/code&gt; 目录下，重启。&lt;/p&gt;
&lt;p&gt;使用 &lt;code class=&quot;language-text&quot;&gt;ip a&lt;/code&gt; 可以看到&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;wlan0: &amp;lt;NO-CARRIER,BROADCAST,MULTICAST,DYNAMIC,UP&amp;gt; mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000
   link/ether b0:f1:ec:xx:xx:xx brd ff:ff:ff:ff:ff:ff&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ifconfig wlan up&lt;/code&gt; 会显示 &lt;code class=&quot;language-text&quot;&gt;SIOCSIFFLAGS: Operation not possible due to RF-kill&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;安装 &lt;code class=&quot;language-text&quot;&gt;rfkill&lt;/code&gt;（如果有必要）：&lt;code class=&quot;language-text&quot;&gt;apt install rfkill&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;rfkill list all&lt;/code&gt; 会显示&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;: hci0: Bluetooth
        Soft blocked: no
        Hard blocked: no
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;: phy0: Wireless LAN
        Soft blocked: no
        Hard blocked: no&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;参考&lt;a href=&quot;https://bbs.archlinux.org/viewtopic.php?pid=1324810#p1324810&quot;&gt;这个问题&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;blacklist hp_wmi&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /etc/modprobe.d/hp.conf&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;重启再输入即可&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;rfkill unblock all&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item></channel></rss>