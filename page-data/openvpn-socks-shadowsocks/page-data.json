{"componentChunkName":"component---src-templates-page-tsx","path":"/openvpn-socks-shadowsocks/","result":{"data":{"site":{"siteMetadata":{"title":"Elsa Granger","description":"Elsa Granger Personal Page","author":{"name":"","url":""}}},"markdownRemark":{"html":"<h2>OpenVPN 转 SOCKS</h2>\n<h3>安装</h3>\n<p>使用 <a href=\"https://github.com/kizzx2/docker-openvpn-client-socks\">docker-openvpn-client-socks</a></p>\n<p>可以直接 <code class=\"language-text\">./start PATH-TO-OVPN-CONF</code> 启动，或者修改 <code class=\"language-text\">start</code></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token shebang important\">#!/bin/sh</span>\n\n<span class=\"token builtin class-name\">exec</span> docker run <span class=\"token punctuation\">\\</span>\n    --rm <span class=\"token punctuation\">\\</span>\n    --device<span class=\"token operator\">=</span>/dev/net/tun <span class=\"token punctuation\">\\</span>\n    --name<span class=\"token operator\">=</span>openvpn-client <span class=\"token punctuation\">\\</span>\n    --cap-add<span class=\"token operator\">=</span>NET_ADMIN <span class=\"token punctuation\">\\</span>\n    --publish <span class=\"token number\">127.0</span>.0.1:1080:1080 <span class=\"token punctuation\">\\</span>\n    --volume <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span>realpath <span class=\"token string\">\"<span class=\"token variable\">$1</span>\"</span><span class=\"token variable\">)</span></span>:/etc/openvpn/:ro\"</span> <span class=\"token punctuation\">\\</span>\n    --sysctl net.ipv6.conf.all.disable_ipv6<span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token punctuation\">\\</span>\n    openvpn-client-socks</code></pre></div>\n<p>其中，去掉了要求 tty 的参数，便于添加为 systemd 服务</p>\n<p>使用 docker build 镜像</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker build <span class=\"token builtin class-name\">.</span> -t openvpn-client-socks</code></pre></div>\n<p>之后就可以使用 curl 进行测试</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">http_proxy</span><span class=\"token operator\">=</span><span class=\"token string\">\"socks://localhost:9050\"</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">https_proxy</span><span class=\"token operator\">=</span><span class=\"token variable\">$http_proxy</span>\n<span class=\"token function\">curl</span> https://github.com -vvvv --head</code></pre></div>\n<h3>备注</h3>\n<p>最好在一个新的文件夹下面放置 OpenVPN 的文件，并且后缀名是 conf 而不是 ovpn</p>\n<p>在 OpenVPN 的配置文件中的 <code class=\"language-text\">dev</code> 选项中，要将 tun 设备名设置为 <code class=\"language-text\">tun0</code>，与 <code class=\"language-text\">sockd.conf</code> 中的 <code class=\"language-text\">external</code> 相匹配</p>\n<h2>SOCKS to Shadowsocks</h2>\n<p>由于使用的是 v2ray，可以转成任意的协议</p>\n<p>配置参考</p>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">{\n  &quot;inbounds&quot;: [\n    {\n      &quot;port&quot;: 16823,\n      &quot;protocol&quot;: &quot;shadowsocks&quot;,\n      &quot;settings&quot;: {\n        &quot;method&quot;: &quot;aes-128-gcm&quot;,\n        &quot;password&quot;: &quot;password&quot;,\n        &quot;level&quot;: 0,\n        &quot;ota&quot;: false,\n        &quot;network&quot;: &quot;tcp&quot;\n      }\n    }\n  ],\n  &quot;outbounds&quot;: [\n    {\n      &quot;protocol&quot;: &quot;socks&quot;,\n      &quot;settings&quot;: {\n        &quot;servers&quot;: [\n          {\n            &quot;address&quot;: &quot;127.0.0.1&quot;,\n            &quot;port&quot;: 9050\n          }\n        ]\n      }\n    }\n  ]\n}</code></pre></div>\n<h2>后记</h2>\n<p>性能要求有点高</p>\n<h3>Pi 3b</h3>\n<p>使用树莓派 3B 跑这一套流程，v2ray 会有极高的延迟，但是直连 SOCKS 就没有问题。速度比较慢，很容易跑满树莓派的 CPU</p>\n<p>vless -> socks -> openvpn</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1140px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.98245614035088%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3AWD/8QAFxABAAMAAAAAAAAAAAAAAAAAEQABIf/aAAgBAQABBQIsNn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAYEAEAAwEAAAAAAAAAAAAAAAABABAhEf/aAAgBAQABPyFTSQWjlf/aAAwDAQACAAMAAAAQg8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAACAgMAAAAAAAAAAAAAAAAAEQExIUFR/9oACAEBAAE/EFJht8IlJWyGs2f/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vless -&gt; socks -&gt; openvpn, pi\"\n        title=\"vless -&gt; socks -&gt; openvpn, pi\"\n        src=\"/static/85dca371e0fbd916094dd4992d54f887/65ac4/vless-socks-openvpn-pi.jpg\"\n        srcset=\"/static/85dca371e0fbd916094dd4992d54f887/65031/vless-socks-openvpn-pi.jpg 285w,\n/static/85dca371e0fbd916094dd4992d54f887/fd252/vless-socks-openvpn-pi.jpg 570w,\n/static/85dca371e0fbd916094dd4992d54f887/65ac4/vless-socks-openvpn-pi.jpg 1140w,\n/static/85dca371e0fbd916094dd4992d54f887/38ece/vless-socks-openvpn-pi.jpg 1280w\"\n        sizes=\"(max-width: 1140px) 100vw, 1140px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>socks -> openvpn</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1140px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.21052631578947%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAUD/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAG4nYs7DAv/xAAaEAABBQEAAAAAAAAAAAAAAAADAAEQMjNB/9oACAEBAAEFAuwbRkCn/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECIf/aAAgBAwEBPwF2LT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAVEAEBAAAAAAAAAAAAAAAAAAAQAf/aAAgBAQAGPwJr/8QAGxABAAEFAQAAAAAAAAAAAAAAALEBESExUWH/2gAIAQEAAT8h7Zv4ojNkr//aAAwDAQACAAMAAAAQ6w//xAAWEQEBAQAAAAAAAAAAAAAAAAABEQD/2gAIAQMBAT8QipMou//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/EIf/xAAdEAACAgEFAAAAAAAAAAAAAAAAARExsSFhceHw/9oACAEBAAE/EGsV0J0NNKc9Ektcnq2Kizmf/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"socks -&gt; openvpn, pi\"\n        title=\"socks -&gt; openvpn, pi\"\n        src=\"/static/915fa7850622b9c17fb40f02e077c648/65ac4/socks-openvpn-pi.jpg\"\n        srcset=\"/static/915fa7850622b9c17fb40f02e077c648/65031/socks-openvpn-pi.jpg 285w,\n/static/915fa7850622b9c17fb40f02e077c648/fd252/socks-openvpn-pi.jpg 570w,\n/static/915fa7850622b9c17fb40f02e077c648/65ac4/socks-openvpn-pi.jpg 1140w,\n/static/915fa7850622b9c17fb40f02e077c648/38ece/socks-openvpn-pi.jpg 1280w\"\n        sizes=\"(max-width: 1140px) 100vw, 1140px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3>x86</h3>\n<p>在一台 i5-4590 机器上跑</p>\n<p>shadowsocks -> socks -> openvpn</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1140px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.63157894736842%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAe4sFZ1Ehf/EABkQAAIDAQAAAAAAAAAAAAAAAAARAQIhEP/aAAgBAQABBQLmkt6VP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/Aar/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAACAwEAAAAAAAAAAAAAAAAAMQEQkUH/2gAIAQEABj8CEdHOjna//8QAHRAAAgEEAwAAAAAAAAAAAAAAAREAITFRYXHB0f/aAAgBAQABPyGrNXqIPwJyg2ZIBbsQirm+Z//aAAwDAQACAAMAAAAQ29//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QZp//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAfEAEAAwAABwEAAAAAAAAAAAABABEhMUFRYYGh0fD/2gAIAQEAAT8QRMoOZKqCArR5PcSyoX0CCpPfBfZiZ/jnFu37kz//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"shadowsocks -&gt; socks -&gt; openvpn, i5-4590\"\n        title=\"shadowsocks -&gt; socks -&gt; openvpn, i5-4590\"\n        src=\"/static/0604741476138a834e7c032e896002c9/65ac4/shadowsocks-socks-openvpn-x86.jpg\"\n        srcset=\"/static/0604741476138a834e7c032e896002c9/65031/shadowsocks-socks-openvpn-x86.jpg 285w,\n/static/0604741476138a834e7c032e896002c9/fd252/shadowsocks-socks-openvpn-x86.jpg 570w,\n/static/0604741476138a834e7c032e896002c9/65ac4/shadowsocks-socks-openvpn-x86.jpg 1140w,\n/static/0604741476138a834e7c032e896002c9/38ece/shadowsocks-socks-openvpn-x86.jpg 1280w\"\n        sizes=\"(max-width: 1140px) 100vw, 1140px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>可能需要优化，但是本身 <code class=\"language-text\">openvpn</code> 服务以及 <code class=\"language-text\">sockd</code> 服务占用的资源就已经比较多了</p>","excerpt":"OpenVPN 转 SOCKS 安装 使用 docker-openvpn-client-socks 可以直接  启动，或者修改  其中，去掉了要求 tty 的参数，便于添加为 systemd 服务 使用 docker build 镜像 之后就可以使用 curl…","frontmatter":{"title":"OpenVPN to Shadowsocks"}}},"pageContext":{"slug":"/openvpn-socks-shadowsocks/"}},"staticQueryHashes":[]}