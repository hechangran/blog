{"componentChunkName":"component---src-templates-page-tsx","path":"/letsencrypt/","result":{"data":{"site":{"siteMetadata":{"title":"Elsa Granger","description":"Elsa Granger Personal Page","author":{"name":"","url":""}}},"markdownRemark":{"html":"<h2>Installation</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> certbot</code></pre></div>\n<h2>Configure</h2>\n<p>假设网站为 example.com</p>\n<p>在 Nginx/OpenResty 对应的 conf 中添加</p>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">location /.well-known/acme-challenge/ {\n    default_type &quot;text/plain&quot;;\n    root /var/www/html/example.com;\n}</code></pre></div>\n<blockquote>\n<p>添加在 http 下的即可</p>\n</blockquote>\n<p>在 <code class=\"language-text\">/var/www/html/example.com</code> 下面创建需要的文件夹</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">pushd</span> /var/www/html/example.com\n<span class=\"token function\">mkdir</span> -p .well-known/acme-challenge</code></pre></div>\n<h2>Obain</h2>\n<h3>Webroot</h3>\n<p><code class=\"language-text\">--email</code> 为申请者邮箱，<code class=\"language-text\">--webroot</code> 为 webroot 方式，<code class=\"language-text\">-w</code> 为站点目录，<code class=\"language-text\">-d</code> 为要加 https 的域名</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">certbot certonly --email root@example.com <span class=\"token punctuation\">\\</span>\n    --webroot -w /var/www/html/example.com <span class=\"token punctuation\">\\</span>\n    -d example.com <span class=\"token punctuation\">\\</span>\n    -d www.example.com</code></pre></div>\n<h3>Standalone</h3>\n<p>需要占用 443 端口，需要停止 Nginx 等服务</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">certbot certonly --email admin@example.com <span class=\"token punctuation\">\\</span>\n    --standalone <span class=\"token punctuation\">\\</span>\n    -d example.com <span class=\"token punctuation\">\\</span>\n    -d www.example.com</code></pre></div>\n<h2>Nginx Conf</h2>\n<p>生成的证书会在 <code class=\"language-text\">/etc/letsencrypt/live/</code> 下面</p>\n<p>Nginx Conf 参考</p>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">server {\n    listen 80;\n    server_name example.com;\n    server_name www.example.com;\n\n    location /.well-known/acme-challenge/ {\n        default_type &quot;text/plain&quot;;\n        root /usr/local/openresty/nginx/html/example.com;\n    }\n\n    location / {\n        return 302 https://$server_name$request_uri;\n    }\n}\n\nserver {\n    listen 443 ssl;\n    listen [::]:443 ssl;\n    server_name example.com;\n    server_name www.example.com;\n\n    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;\n\n    location / {\n        include proxy_params;\n        proxy_pass http://127.0.0.1:3000;\n    }\n}</code></pre></div>\n<h2>Auto Renew</h2>\n<p>在 cron 中添加</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">0 0 * */2 * certbot renew --quiet --post-hook &quot;openresty -s reload&quot;</code></pre></div>\n<p>每隔两个月，在 0 点 0 分自动续期</p>","excerpt":"Installation Configure 假设网站为 example.com 在 Nginx/OpenResty 对应的 conf 中添加 添加在 http 下的即可 在  下面创建需要的文件夹 Obain Webroot  为申请者邮箱， 为 webroot…","frontmatter":{"title":"Let's Encrypt 配置"}}},"pageContext":{"slug":"/letsencrypt/"}},"staticQueryHashes":[]}