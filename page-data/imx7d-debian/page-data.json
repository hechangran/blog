{"componentChunkName":"component---src-templates-page-tsx","path":"/imx7d-debian/","result":{"data":{"site":{"siteMetadata":{"title":"Elsa Granger","description":"Elsa Granger Personal Page","author":{"name":"","url":""}}},"markdownRemark":{"html":"<p>Android Things 有两个官方支持的版本，一个是 <code class=\"language-text\">NXP i.MX7D</code>，另一个是 <code class=\"language-text\">Raspberry Pi</code>。后者没有什么可说的，主要是前者应该当如何安装。</p>\n<p>主要参考了<a href=\"https://www.digikey.com/eewiki/display/linuxonarm/PICO-PI-IMX7\">这个文章</a></p>\n<h2>Toolchain</h2>\n<p>我们需要的有：<code class=\"language-text\">imx_usb_loader</code>，<code class=\"language-text\">ARM Cross Compiler: GCC</code>，<code class=\"language-text\">Bootloader: U-Boot</code></p>\n<h3>imx_usb_loader</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone https://github.com/boundarydevices/imx_usb_loader\n<span class=\"token builtin class-name\">cd</span> imx_usb_loader/\n<span class=\"token function\">make</span></code></pre></div>\n<h3>ARM Cross Compiler: GCC</h3>\n<p>在<a href=\"https://www.linaro.org/downloads/\">这里</a>找最新的 ARM GCC 交叉编译编译器。</p>\n<p>写这篇文章时最新的为7.5.0</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">wget</span> -c https://releases.linaro.org/components/toolchain/binaries/latest-7/arm-linux-gnueabihf/gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabihf.tar.xz\n<span class=\"token function\">tar</span> xf gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabihf.tar.xz\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">CC</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">`</span></span>/gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabihf/bin/arm-linux-gnueabihf-</code></pre></div>\n<p>测试一下交叉编译器：</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token variable\">${CC}</span>gcc --version</code></pre></div>\n<h3>Bootloader: U-Boot</h3>\n<p>在 <a href=\"https://github.com/u-boot/u-boot\">https://github.com/u-boot/u-boot</a> 上找最新的分支，写文章时为<code class=\"language-text\">v2020.10-rc4</code>。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone -b v2020.10-rc4 https://github.com/u-boot/u-boot --depth<span class=\"token operator\">=</span><span class=\"token number\">1</span>\n<span class=\"token builtin class-name\">cd</span> u-boot/</code></pre></div>\n<p>编译 u-boot</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">make</span> <span class=\"token assign-left variable\">ARCH</span><span class=\"token operator\">=</span>arm <span class=\"token assign-left variable\">CROSS_COMPILE</span><span class=\"token operator\">=</span><span class=\"token variable\">${CC}</span> distclean\n<span class=\"token function\">make</span> <span class=\"token assign-left variable\">ARCH</span><span class=\"token operator\">=</span>arm <span class=\"token assign-left variable\">CROSS_COMPILE</span><span class=\"token operator\">=</span><span class=\"token variable\">${CC}</span> pico-pi-imx7d_defconfig\n<span class=\"token function\">make</span> <span class=\"token assign-left variable\">ARCH</span><span class=\"token operator\">=</span>arm <span class=\"token assign-left variable\">CROSS_COMPILE</span><span class=\"token operator\">=</span><span class=\"token variable\">${CC}</span></code></pre></div>\n<h2>从 U-BOOT 启动</h2>\n<h3>设置跳线</h3>\n<p>跳线的具体设置可以参考这里：<a href=\"https://www.technexion.com/support/knowledgebase/boot-configuration-settings-for-pico-baseboards/\">https://www.technexion.com/support/knowledgebase/boot-configuration-settings-for-pico-baseboards/</a></p>\n<p>我们需要设置为 USB Boot 启动，即跳线设置为</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 513px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.78947368421053%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADhUlEQVQozw2O2W/aBgCH/dJN01Z1D6uatiHZknIkAQcbbA5jGzCHMTY3BEwDmCvB3EcSCFfSkITmaCulSda16aaoe5i6Pkw7VE3a3qZJe9gfsIftXxnS7+F7+fT9AC2El0ptyedSns8zrvBgcCKVghmhwsdyx8eXUhmYFcqphHg4vtQgpmat3+uMDk8uaDY07B8DPn/I6fHHizW7izVgJO2NRnJFjLTpDVSYF5PihtFC25lALFv38hkH418V1huDvWBqTVirAUEh0+p2r3/4XvXQiZFk9/BAv1tKbK5XKq3UwemkPhyOEvXOysbg5/e/axwc6mH/+fe/83c/RYotQLMaKXSLz756rC9E+Vhi92CfEDOl7cZ4fEJ26ubNtR/fvmldvUCE1JtvLlNHY3e7/v6Xd7nX58aSCHSenInNzaPjZ2KxzUeyIb+QFRrpVC0eyU0uFfcOx4/G5cEeL9b7nWF5dJDp9a6vrqrXXyfOzoDaxs5gq1+rbPP8ejpdivPrK5F8NtMo5JuJbK1U7dUq/XZzd6u5szM43aj0Rzunf/3x96+//dn+7i0AW2yQanlBASFaq8sVZt1Ri5njON7niZEWt88fz2cr6XQ5GS+UClvVSi8UykRD0ccnT5MXTwEmEL079QWkxq0WTq+zGg3OiWm3+UPBpGIJVoF6p91H4DSJ02aSwSdg4RCN2cFGa68vAUckGmA8CGJmmRXaETRhjM0ecLki4VBycRGempqXTMtAJapWG2AIW142YEaHmaBZP194eQGgnNtBUgThxjGGJFiK8tson80R5Lj4EojoDJSN8ijksHJRC8MmFx1kXHwqLjx//iW1vwXoIgGZYhHW6mEjbtRhBj0G6XGdHlOrEbUBxwiH1cppUfOkbKe8Xh8/mZVwtvZOW9ffAlAsEOJZzmO6KZ/BjagVN9ycnfGwpNNqmF2GUcKIo+CsbOHO/Rm3jXhAoDJUZbdpSk8Oy69eAio+sH/0aDBs3ViSZFNCq1q9cfd2Lre62+8hLk5t1A4b+WmFXDI3N2iWVAGnMea7OD9uvHrBjrYBSz5tFlbnKeIT+bwU1EpB+GPJfcLNWn0RHeudgyAlgmpNxMzcg5VYGooGF5KhxNGBai2zJPJAtNmFvL6PlPJb89IPpyW3FLIpUG0Lp0DKjXmCWsr+we07lJ1eXFImMyIS5z+LM5+66Xs0C4oP/weq/i+481jf3AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jumper usb boot\"\n        title=\"jumper usb boot\"\n        src=\"/static/f2aaedbd2e4eae1ca18491bc5d9a1a0e/bb9ec/pico-imx6-pi-serial-download-mode.png\"\n        srcset=\"/static/f2aaedbd2e4eae1ca18491bc5d9a1a0e/5459c/pico-imx6-pi-serial-download-mode.png 285w,\n/static/f2aaedbd2e4eae1ca18491bc5d9a1a0e/bb9ec/pico-imx6-pi-serial-download-mode.png 513w\"\n        sizes=\"(max-width: 513px) 100vw, 513px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<div class=\"admonition admonition-note alert alert--secondary\"><div class=\"admonition-heading\"><h5><span class=\"admonition-icon\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"16\" viewBox=\"0 0 14 16\"><path fill-rule=\"evenodd\" d=\"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z\"></path></svg></span>note</h5></div><div class=\"admonition-content\"><p>板子上有两个跳线连接的地方，要注意应该修改哪个地方</p></div></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">lsusb <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> Freescale\n<span class=\"token comment\"># Output: Bus 00x Device 00y: ID 15a2:0076 Freescale Semiconductor, Inc</span></code></pre></div>\n<div class=\"admonition admonition-caution alert alert--warning\"><div class=\"admonition-heading\"><h5><span class=\"admonition-icon\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z\"></path></svg></span>Notes</h5></div><div class=\"admonition-content\"><p>如果没有从 usb 启动，不会有 Freescale 的设备，设备的 ID 也是无法对应上的。</p><p>如果使用的是 emmc 启动，即 Android，那么显示的是 Google Inc. 的设备，以及设备 ID 将是 18d1:4ee7</p></div></div>\n<h3>使用 USB 加载镜像</h3>\n<p>加载 SPL</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> ~/imx_usb_loader/imx_usb SPL</code></pre></div>\n<p>加载 u-boot-dtb.img</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> ~/imx_usb_loader/imx_usb u-boot-dtb.img</code></pre></div>\n<div class=\"admonition admonition-note alert alert--secondary\"><div class=\"admonition-heading\"><h5><span class=\"admonition-icon\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"16\" viewBox=\"0 0 14 16\"><path fill-rule=\"evenodd\" d=\"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z\"></path></svg></span>启动串口</h5></div><div class=\"admonition-content\"><p>在加载 u-boot-dtb.img 之前，需要打开另一个窗口，打印出串口的内容。</p></div></div>\n<div class=\"admonition admonition-important alert alert--info\"><div class=\"admonition-heading\"><h5><span class=\"admonition-icon\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"16\" viewBox=\"0 0 14 16\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg></span>串口设置</h5></div><div class=\"admonition-content\"><p>可以使用 minicom 进行连接</p><p>串口配置：115200, 8N1, 无硬件、软件流控制</p><p><strong>要将硬件流控制关掉，否则将无法输入，也无法跳过 autostart</strong></p></div></div>\n<div class=\"admonition admonition-important alert alert--info\"><div class=\"admonition-heading\"><h5><span class=\"admonition-icon\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"16\" viewBox=\"0 0 14 16\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg></span>避免 autostart</h5></div><div class=\"admonition-content\"><p>并且，在 u-boot-dtb.img 加载之后，会立即启动，需要在串口中快速地按下任意键以避免 autostart。</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Loading Environment from MMC... OK\nIn:    serial\nOut:   serial\nErr:   serial\nNet:   FEC0\nHit any key to stop autoboot:  0\n=&gt;</code></pre></div></div></div>\n<h3>将 u-boot 写入 emmc</h3>\n<p>在前面按下任意键后，会进入 u-boot 命令行，在串口中依次执行</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">=&gt; env default -f -a\n=&gt; setenv bootm_boot_mode nonsec\n=&gt; saveenv</code></pre></div>\n<div class=\"admonition admonition-note alert alert--secondary\"><div class=\"admonition-heading\"><h5><span class=\"admonition-icon\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"16\" viewBox=\"0 0 14 16\"><path fill-rule=\"evenodd\" d=\"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z\"></path></svg></span>note</h5></div><div class=\"admonition-content\"><p>以 <code class=\"language-text\">=&gt;</code> 开头的为在串口中执行</p><p>反之为在 <code class=\"language-text\">shell</code> 中执行</p></div></div>\n<p>将 mmc 0 设置为从数据分区启动，而不是从 boot 分区启动</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">=&gt; mmc partconf 0 0 7 0</code></pre></div>\n<p>进入 DFU 模式</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">=&gt; dfu 0 mmc 0</code></pre></div>\n<p>刷入 SPL，需要安装 dfu-util</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> dfu-util -D SPL -a spl</code></pre></div>\n<p>刷入 u-boot-dtb.img</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> dfu-util -R -D u-boot-dtb.img -a u-boot</code></pre></div>\n<h3>从 emmc 启动</h3>\n<p>拔掉电源，将跳线设置为 emmc 启动。</p>\n<p>跳线如图：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 591px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.07017543859648%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAADSklEQVQozw3RWVMadwAA8H3qNG06nc50Rls0mUqEVIHIDXLI5YKAcrOwLiy7/BeWZUEWFlAIglgFT6KikdarbdIr00kz4/S9fepX6EO/S/P7Cj8omS454cBmewAorsy3SXLtYvSaytdyucr5y5+yTJWvduls+fj0lgRlALiTk2uWa200eiRRgMI4jSczsVWwEk+RoIhimUxxPZrM+PwIw1ZTNOf2R4ORJFvtLK5EASgcDW+oaovM873DS6h2NAyieJQEf/z9l5cHRpOVPuglrvt5ls5udPrv7vvHA1+Kqg6Gb979+dHMs9Obq3/+/Y/q7O8MLyFqZztIZdPVyv75nnYtxjA5/rCr6ZB3d4NQryWrZ9/8+i0/OnUV2Fevrx3Pmwejwej+l8Xd9vrxGdS+vm02uvEYiIYJGvB4Ko/GKW57++b2rntzm7t4cXo26I4uXavJIluh6w2mWM1Xm2iRv/35LbT/6rfOZj9NFLFEDkWzJFkAoISTpbMXL9s7J2St09s9am5+o9JbiBRLYDSOs0SSTcXS+e4hFG/UfIGYaykSCGEms9PvxwJB7IlYLpmd0xth2IsaDXa1el4slkWiRDCQ8HgjK37U54tjtTZUPj6hcxUkRkYQgs3X3w8Bqjj5SCSVKFUai9YAi6YVOr1dp7fqtBaV0iKVaT9+8JkpHDj4/R5y13gCcFxpc63Uaj7fazT6eYY3L7gKDIuRjBH2G+btSqVZrV7QaayepfC0SK6SSr1r5MLWBuQsc0GcCiDk+2EScOXyFpbImGH3ksufrXWc8cSyN+p0RxRqi83hx5OMUm6AHU728Ig5v4LCjbomgahdFpNB/vlToUqhkM7JhFaty66S2UxGJKRWzApnZ8YnHjttJpHDpNLNxQCy/v0Pplod+soHT8CWEJXcahQeiMYQJBxDkXH3/MXFXmV7Sx0KZJJBiVw6NjHRqpcfhRZBJXv19sfV4cBR56Epv0vsdeg8To3D+nBKIH6mmNGbhUHPxtl3kXJdHw5OSSRSuVwgECyHYjNYQMEBLV/6kkCWd9uQ0AtbCVLj8X74WPBwcvKD8S8+mRU/sdrsq9mvnS5LODwmmlabbfM2a4pmn/qXP12x6nBUx6YFZOR/yCoz+MztLYEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jumper emmc boot\"\n        title=\"jumper emmc boot\"\n        src=\"/static/8d60928c9ab2a895918d1005a6c6e754/3d4ad/pico-imx6-pi-emmc.png\"\n        srcset=\"/static/8d60928c9ab2a895918d1005a6c6e754/5459c/pico-imx6-pi-emmc.png 285w,\n/static/8d60928c9ab2a895918d1005a6c6e754/2cee3/pico-imx6-pi-emmc.png 570w,\n/static/8d60928c9ab2a895918d1005a6c6e754/3d4ad/pico-imx6-pi-emmc.png 591w\"\n        sizes=\"(max-width: 591px) 100vw, 591px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>加电之后，启动板子，进入 u-boot，这里不需要跳过 autoboot</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Loading Environment from MMC... OK\nIn:    serial\nOut:   serial\nErr:   serial\nNet:   FEC0\nHit any key to stop autoboot:  0\n=&gt;</code></pre></div>\n<p>启动 USB 存储模式</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">=&gt; ums 0 mmc 0</code></pre></div>\n<p>之后会卡住，操作在电脑上完成</p>\n<div class=\"admonition admonition-note alert alert--secondary\"><div class=\"admonition-heading\"><h5><span class=\"admonition-icon\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"16\" viewBox=\"0 0 14 16\"><path fill-rule=\"evenodd\" d=\"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z\"></path></svg></span>GPT</h5></div><div class=\"admonition-content\"><p>可能出现 GPT 分区头部 CRC 校验错误，可以忽略</p></div></div>\n<h2>Linux Kernel</h2>\n<p>下载 kernel、modules、device tree</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone https://github.com/RobertCNelson/armv7-lpae-multiplatform\n<span class=\"token builtin class-name\">cd</span> armv7-lpae-multiplatform/</code></pre></div>\n<p>切换到对应分支以选择相应的内核</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> checkout origin/v5.4.x -b tmp</code></pre></div>\n<p>编译内核</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">./build_kernel.sh</code></pre></div>\n<p>这个脚本会生成内核、模块以及设备树</p>\n<p>在结束后，脚本会显示</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">-----------------------------\nScript Complete\neewiki.net: [user@localhost:~$ export kernel_version=5.X.Y-Z]\n-----------------------------</code></pre></div>\n<p>记录 kernel_version，并执行</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">kernel_version</span><span class=\"token operator\">=</span><span class=\"token number\">5</span>.X.Y-Z</code></pre></div>\n<h2>Rootfs</h2>\n<p>在 <a href=\"https://rcn-ee.com/rootfs/eewiki/minfs/\">https://rcn-ee.com/rootfs/eewiki/minfs/</a> 找到 debian 或者 ubuntu 对应的 rootfs</p>\n<p>ubuntu 的默认账号密码为：</p>\n<table>\n<thead>\n<tr>\n<th>账号</th>\n<th>密码</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ubuntu</td>\n<td>temppwd</td>\n</tr>\n</tbody>\n</table>\n<p>debian 的默认账号密码为：</p>\n<table>\n<thead>\n<tr>\n<th>账号</th>\n<th>密码</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>debian</td>\n<td>temppwd</td>\n</tr>\n</tbody>\n</table>\n<p>以 debian 为例子</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wget -c https://rcn-ee.com/rootfs/eewiki/minfs/debian-10.5-minimal-armhf-2020-08-24.tar.xz</code></pre></div>\n<p>解压</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">tar xf debian-10.5-minimal-armhf-2020-08-24.tar.xz</code></pre></div>\n<h2>设置本地存储</h2>\n<p>使用 <code class=\"language-text\">lsblk</code> 确定上文中，emmc 的 usb 模式对应的磁盘，为 <code class=\"language-text\">/dev/sdb</code> 或 <code class=\"language-text\">/dev/mmcblk0</code> 或类似</p>\n<p>设置为环境变量：</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DISK</span><span class=\"token operator\">=</span>/dev/sdb\n<span class=\"token comment\"># 或</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DISK</span><span class=\"token operator\">=</span>/dev/mmcblk0</code></pre></div>\n<h3>清空分区表</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">dd</span> <span class=\"token assign-left variable\">if</span><span class=\"token operator\">=</span>/dev/zero <span class=\"token assign-left variable\">of</span><span class=\"token operator\">=</span><span class=\"token variable\">${DISK}</span> <span class=\"token assign-left variable\">bs</span><span class=\"token operator\">=</span>1M <span class=\"token assign-left variable\">count</span><span class=\"token operator\">=</span><span class=\"token number\">10</span></code></pre></div>\n<h3>将 SPL 和 u-boot-dtb.img 写入到 EMMC 中</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">dd</span> <span class=\"token assign-left variable\">if</span><span class=\"token operator\">=</span>./u-boot/SPL <span class=\"token assign-left variable\">of</span><span class=\"token operator\">=</span><span class=\"token variable\">${DISK}</span> <span class=\"token assign-left variable\">seek</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">bs</span><span class=\"token operator\">=</span>1k\n<span class=\"token function\">sudo</span> <span class=\"token function\">dd</span> <span class=\"token assign-left variable\">if</span><span class=\"token operator\">=</span>./u-boot/u-boot-dtb.img <span class=\"token assign-left variable\">of</span><span class=\"token operator\">=</span><span class=\"token variable\">${DISK}</span> <span class=\"token assign-left variable\">seek</span><span class=\"token operator\">=</span><span class=\"token number\">69</span> <span class=\"token assign-left variable\">bs</span><span class=\"token operator\">=</span>1k</code></pre></div>\n<h3>创建分区表</h3>\n<p>对于 <code class=\"language-text\">sfdisk</code> 版本大于等于 2.26.x</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> sfdisk <span class=\"token variable\">${DISK}</span> <span class=\"token operator\">&lt;&lt;-</span><span class=\"token string\">EOF\n1M,,L,*\nEOF</span></code></pre></div>\n<p>对于 <code class=\"language-text\">sfdisk</code> 版本小于等于 2.25.x</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> sfdisk --unit M <span class=\"token variable\">${DISK}</span> <span class=\"token operator\">&lt;&lt;-</span><span class=\"token string\">EOF\n1,,L,*\nEOF</span></code></pre></div>\n<h3>格式化</h3>\n<p>使用 <code class=\"language-text\">sfdisk</code> 查看 <code class=\"language-text\">type</code> 为 <code class=\"language-text\">part</code> 的分区，如 <code class=\"language-text\">/dev/sdb1</code> 或 <code class=\"language-text\">/dev/mmcblk0p1</code></p>\n<p>格式化为 ext4</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> mkfs.ext4 -L rootfs /dev/sdb1\n<span class=\"token comment\"># 或</span>\n<span class=\"token function\">sudo</span> mkfs.ext4 -L rootfs /dev/mmcblk0p1</code></pre></div>\n<h3>挂载</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> -p /media/rootfs/\n\n<span class=\"token function\">sudo</span> <span class=\"token function\">mount</span> /dev/sdb1 /media/rootfs/\n<span class=\"token comment\"># 或</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">mount</span> /dev/mmcblk0p1 /media/rootfs/</code></pre></div>\n<h3>复制 rootfs</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">tar</span> xfvp ./debian-*-*-armhf-*/armhf-rootfs-*.tar -C /media/rootfs/\n<span class=\"token function\">sync</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> root:root /media/rootfs/\n<span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> <span class=\"token number\">755</span> /media/rootfs/</code></pre></div>\n<h3>设置 extlinux.conf</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> -p /media/rootfs/boot/extlinux/\n<span class=\"token function\">sudo</span> <span class=\"token function\">sh</span> -c <span class=\"token string\">\"echo 'label Linux <span class=\"token variable\">${kernel_version}</span>' > /media/rootfs/boot/extlinux/extlinux.conf\"</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">sh</span> -c <span class=\"token string\">\"echo '    kernel /boot/vmlinuz-<span class=\"token variable\">${kernel_version}</span>' >> /media/rootfs/boot/extlinux/extlinux.conf\"</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">sh</span> -c <span class=\"token string\">\"echo '    append root=/dev/mmcblk2p1 ro rootfstype=ext4 rootwait quiet' >> /media/rootfs/boot/extlinux/extlinux.conf\"</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">sh</span> -c <span class=\"token string\">\"echo '    fdtdir /boot/dtbs/<span class=\"token variable\">${kernel_version}</span>/' >> /media/rootfs/boot/extlinux/extlinux.conf\"</span></code></pre></div>\n<h3>复制 Linux 内核、设备树和模块</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> -v ./armv7-lpae-multiplatform/deploy/<span class=\"token variable\">${kernel_version}</span>*.zImage /media/rootfs/boot/vmlinuz-<span class=\"token variable\">${kernel_version}</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> -p /media/rootfs/boot/dtbs/<span class=\"token variable\">${kernel_version}</span>/\n<span class=\"token function\">sudo</span> <span class=\"token function\">tar</span> xfv ./armv7-lpae-multiplatform/deploy/<span class=\"token variable\">${kernel_version}</span>-dtbs.tar.gz -C /media/rootfs/boot/dtbs/<span class=\"token variable\">${kernel_version}</span>/\n<span class=\"token function\">sudo</span> <span class=\"token function\">tar</span> xfv ./armv7-lpae-multiplatform/deploy/<span class=\"token variable\">${kernel_version}</span>-modules.tar.gz -C /media/rootfs/</code></pre></div>\n<h3>File Systems Table (/etc/fstab)</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">sh</span> -c <span class=\"token string\">\"echo '/dev/mmcblk2p1  /  auto  errors=remount-ro  0  1' >> /media/rootfs/etc/fstab\"</span></code></pre></div>\n<h3>umount &#x26; exit</h3>\n<p>umount 挂载的盘</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sync</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">umount</span> /media/rootfs</code></pre></div>\n<p>u-boot 退出 usb 挂载 emmc 模式</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Loading Environment from MMC... OK\nIn:    serial\nOut:   serial\nErr:   serial\nNet:   FEC0\nHit any key to stop autoboot:  0\n=&gt; ums 0 mmc 0\nUMS: LUN 0, dev0, hwpart 0, section 0x0, count 0x720000\nCtrl+C to exit ...\n=&gt; reset</code></pre></div>\n<h2>启动设备</h2>\n<p>默认的账户与密码在下载 rootfs 中有提到</p>\n<h2>启用另一个 CPU</h2>\n<p>使用 <code class=\"language-text\">sudo lshw</code> 列出硬件信息，可以看出有一个 CPU 内核被禁用，这是由于使用安全模式加载了主线内核的原因</p>\n<p>可以在启动的时候在串口命令中输入</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">=&gt; env default -f -a\n=&gt; setenv bootm_boot_mode nonsec\n=&gt; saveenv</code></pre></div>\n<p>之后再 <code class=\"language-text\">reset</code> 重新启动，重新使用 <code class=\"language-text\">lshw</code>，可以看出 cpu1 也启用了</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">*-core\n       description: Motherboard\n       physical id: 0\n     *-cpu:0\n          description: CPU\n          product: cpu\n          physical id: 0\n          bus info: cpu@0\n          size: 996MHz\n          capabilities: half thumb fastmult vfp edsp thumbee neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm\n     *-cpu:1\n          description: CPU\n          product: cpu\n          physical id: 1\n          bus info: cpu@1\n          size: 996MHz\n          capabilities: half thumb fastmult vfp edsp thumbee neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm\n     *-cpu:2 DISABLED\n          description: CPU\n          product: idle-states\n          physical id: 2\n          bus info: cpu@2\n     *-memory\n          description: System memory\n          physical id: 3\n          size: 422MiB</code></pre></div>\n<div class=\"admonition admonition-note alert alert--secondary\"><div class=\"admonition-heading\"><h5><span class=\"admonition-icon\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"16\" viewBox=\"0 0 14 16\"><path fill-rule=\"evenodd\" d=\"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z\"></path></svg></span>PSCI</h5></div><div class=\"admonition-content\"><p>理论上，可以通过启用 PSCI 来实现使用安全模式下仍然可以使用另一个 CPU</p></div></div>\n<h2>WLAN</h2>\n<p>安装完后，仍然只能使用 LAN 联网，<code class=\"language-text\">ip a</code>下面无法出现 wlan0。</p>\n<p>通过 <code class=\"language-text\">dmesg</code> 可以检查到 brcmfmac 的驱动启动时缺少 <code class=\"language-text\">brcmfmac4339-sdio.txt</code> 和 <code class=\"language-text\">brcmfmac4339-sdio.technexion,imx7d-pico-pi.txt</code> 两个文件。</p>\n<p>在<a href=\"https://fossies.org/linux/buildroot/board/technexion/imx7dpico/rootfs_overlay/lib/firmware/brcm/brcmfmac4339-sdio.txt\">网络</a>上可以找到 <code class=\"language-text\">brcmfmac4339-sdio.txt</code> 文件，将其放进 <code class=\"language-text\">/lib/firmware/bcrm</code> 目录下，重启。</p>\n<p>使用 <code class=\"language-text\">ip a</code> 可以看到</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">wlan0: &lt;NO-CARRIER,BROADCAST,MULTICAST,DYNAMIC,UP&gt; mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000\n   link/ether b0:f1:ec:xx:xx:xx brd ff:ff:ff:ff:ff:ff</code></pre></div>\n<p>不过现在还不知道怎么把这个网卡 UP 起来</p>","excerpt":"Android Things 有两个官方支持的版本，一个是 ，另一个是 。后者没有什么可说的，主要是前者应该当如何安装。 主要参考了这个文章 Toolchain 我们需要的有：，， imx_usb_loader ARM Cross Compiler: GCC…","frontmatter":{"title":"在 Android Things 上安装 Debian"}}},"pageContext":{"slug":"/imx7d-debian/"}},"staticQueryHashes":[]}